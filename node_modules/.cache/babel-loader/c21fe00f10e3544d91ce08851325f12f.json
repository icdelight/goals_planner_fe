{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = createPersistoid;\n\nvar _constants = require(\"./constants\"); // @TODO remove once flow < 0.63 support is no longer required.\n\n\nfunction createPersistoid(config) {\n  // defaults\n  var blacklist = config.blacklist || null;\n  var whitelist = config.whitelist || null;\n  var transforms = config.transforms || [];\n  var throttle = config.throttle || 0;\n  var storageKey = \"\".concat(config.keyPrefix !== undefined ? config.keyPrefix : _constants.KEY_PREFIX).concat(config.key);\n  var storage = config.storage;\n  var serialize;\n\n  if (config.serialize === false) {\n    serialize = function serialize(x) {\n      return x;\n    };\n  } else if (typeof config.serialize === 'function') {\n    serialize = config.serialize;\n  } else {\n    serialize = defaultSerialize;\n  }\n\n  var writeFailHandler = config.writeFailHandler || null; // initialize stateful values\n\n  var lastState = {};\n  var stagedState = {};\n  var keysToProcess = [];\n  var timeIterator = null;\n  var writePromise = null;\n\n  var update = function update(state) {\n    // add any changed keys to the queue\n    Object.keys(state).forEach(function (key) {\n      if (!passWhitelistBlacklist(key)) return; // is keyspace ignored? noop\n\n      if (lastState[key] === state[key]) return; // value unchanged? noop\n\n      if (keysToProcess.indexOf(key) !== -1) return; // is key already queued? noop\n\n      keysToProcess.push(key); // add key to queue\n    }); //if any key is missing in the new state which was present in the lastState,\n    //add it for processing too\n\n    Object.keys(lastState).forEach(function (key) {\n      if (state[key] === undefined && passWhitelistBlacklist(key) && keysToProcess.indexOf(key) === -1 && lastState[key] !== undefined) {\n        keysToProcess.push(key);\n      }\n    }); // start the time iterator if not running (read: throttle)\n\n    if (timeIterator === null) {\n      timeIterator = setInterval(processNextKey, throttle);\n    }\n\n    lastState = state;\n  };\n\n  function processNextKey() {\n    if (keysToProcess.length === 0) {\n      if (timeIterator) clearInterval(timeIterator);\n      timeIterator = null;\n      return;\n    }\n\n    var key = keysToProcess.shift();\n    var endState = transforms.reduce(function (subState, transformer) {\n      return transformer[\"in\"](subState, key, lastState);\n    }, lastState[key]);\n\n    if (endState !== undefined) {\n      try {\n        stagedState[key] = serialize(endState);\n      } catch (err) {\n        console.error('reduxjs-toolkit-persist/createPersistoid: error serializing state', err);\n      }\n    } else {\n      //if the endState is undefined, no need to persist the existing serialized content\n      delete stagedState[key];\n    }\n\n    if (keysToProcess.length === 0) {\n      writeStagedState();\n    }\n  }\n\n  function writeStagedState() {\n    // cleanup any removed keys just before write.\n    Object.keys(stagedState).forEach(function (key) {\n      if (lastState[key] === undefined) {\n        delete stagedState[key];\n      }\n    });\n    writePromise = storage.setItem(storageKey, serialize(stagedState))[\"catch\"](onWriteFail);\n  }\n\n  function passWhitelistBlacklist(key) {\n    if (whitelist && whitelist.indexOf(key) === -1 && key !== '_persist') return false;\n    if (blacklist && blacklist.indexOf(key) !== -1) return false;\n    return true;\n  }\n\n  function onWriteFail(err) {\n    // @TODO add fail handlers (typically storage full)\n    if (writeFailHandler) writeFailHandler(err);\n\n    if (err && process.env.NODE_ENV !== 'production') {\n      console.error('Error storing data', err);\n    }\n  }\n\n  var flush = function flush() {\n    while (keysToProcess.length !== 0) {\n      processNextKey();\n    }\n\n    return writePromise || Promise.resolve();\n  }; // return `persistoid`\n\n\n  return {\n    update: update,\n    flush: flush\n  };\n} // @NOTE in the future this may be exposed via config\n\n\nfunction defaultSerialize(data) {\n  return JSON.stringify(data);\n}","map":{"version":3,"sources":["/Users/harmadini/Work/Free/React/goals_planner_fe/goals_planner_fe/node_modules/reduxjs-toolkit-persist/es/createPersistoid.js"],"names":["Object","defineProperty","exports","value","createPersistoid","_constants","require","config","blacklist","whitelist","transforms","throttle","storageKey","concat","keyPrefix","undefined","KEY_PREFIX","key","storage","serialize","x","defaultSerialize","writeFailHandler","lastState","stagedState","keysToProcess","timeIterator","writePromise","update","state","keys","forEach","passWhitelistBlacklist","indexOf","push","setInterval","processNextKey","length","clearInterval","shift","endState","reduce","subState","transformer","err","console","error","writeStagedState","setItem","onWriteFail","process","env","NODE_ENV","flush","Promise","resolve","data","JSON","stringify"],"mappings":"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","sourcesContent":["\"use strict\";\n\nrequire(\"core-js/modules/es.object.define-property.js\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = createPersistoid;\n\nrequire(\"core-js/modules/es.array.concat.js\");\n\nrequire(\"core-js/modules/es.array.for-each.js\");\n\nrequire(\"core-js/modules/web.dom-collections.for-each.js\");\n\nrequire(\"core-js/modules/es.object.keys.js\");\n\nrequire(\"core-js/modules/es.array.index-of.js\");\n\nrequire(\"core-js/modules/web.timers.js\");\n\nrequire(\"core-js/modules/es.array.reduce.js\");\n\nrequire(\"core-js/modules/es.object.to-string.js\");\n\nrequire(\"core-js/modules/es.promise.js\");\n\nvar _constants = require(\"./constants\");\n\n// @TODO remove once flow < 0.63 support is no longer required.\nfunction createPersistoid(config) {\n  // defaults\n  var blacklist = config.blacklist || null;\n  var whitelist = config.whitelist || null;\n  var transforms = config.transforms || [];\n  var throttle = config.throttle || 0;\n  var storageKey = \"\".concat(config.keyPrefix !== undefined ? config.keyPrefix : _constants.KEY_PREFIX).concat(config.key);\n  var storage = config.storage;\n  var serialize;\n\n  if (config.serialize === false) {\n    serialize = function serialize(x) {\n      return x;\n    };\n  } else if (typeof config.serialize === 'function') {\n    serialize = config.serialize;\n  } else {\n    serialize = defaultSerialize;\n  }\n\n  var writeFailHandler = config.writeFailHandler || null; // initialize stateful values\n\n  var lastState = {};\n  var stagedState = {};\n  var keysToProcess = [];\n  var timeIterator = null;\n  var writePromise = null;\n\n  var update = function update(state) {\n    // add any changed keys to the queue\n    Object.keys(state).forEach(function (key) {\n      if (!passWhitelistBlacklist(key)) return; // is keyspace ignored? noop\n\n      if (lastState[key] === state[key]) return; // value unchanged? noop\n\n      if (keysToProcess.indexOf(key) !== -1) return; // is key already queued? noop\n\n      keysToProcess.push(key); // add key to queue\n    }); //if any key is missing in the new state which was present in the lastState,\n    //add it for processing too\n\n    Object.keys(lastState).forEach(function (key) {\n      if (state[key] === undefined && passWhitelistBlacklist(key) && keysToProcess.indexOf(key) === -1 && lastState[key] !== undefined) {\n        keysToProcess.push(key);\n      }\n    }); // start the time iterator if not running (read: throttle)\n\n    if (timeIterator === null) {\n      timeIterator = setInterval(processNextKey, throttle);\n    }\n\n    lastState = state;\n  };\n\n  function processNextKey() {\n    if (keysToProcess.length === 0) {\n      if (timeIterator) clearInterval(timeIterator);\n      timeIterator = null;\n      return;\n    }\n\n    var key = keysToProcess.shift();\n    var endState = transforms.reduce(function (subState, transformer) {\n      return transformer[\"in\"](subState, key, lastState);\n    }, lastState[key]);\n\n    if (endState !== undefined) {\n      try {\n        stagedState[key] = serialize(endState);\n      } catch (err) {\n        console.error('reduxjs-toolkit-persist/createPersistoid: error serializing state', err);\n      }\n    } else {\n      //if the endState is undefined, no need to persist the existing serialized content\n      delete stagedState[key];\n    }\n\n    if (keysToProcess.length === 0) {\n      writeStagedState();\n    }\n  }\n\n  function writeStagedState() {\n    // cleanup any removed keys just before write.\n    Object.keys(stagedState).forEach(function (key) {\n      if (lastState[key] === undefined) {\n        delete stagedState[key];\n      }\n    });\n    writePromise = storage.setItem(storageKey, serialize(stagedState))[\"catch\"](onWriteFail);\n  }\n\n  function passWhitelistBlacklist(key) {\n    if (whitelist && whitelist.indexOf(key) === -1 && key !== '_persist') return false;\n    if (blacklist && blacklist.indexOf(key) !== -1) return false;\n    return true;\n  }\n\n  function onWriteFail(err) {\n    // @TODO add fail handlers (typically storage full)\n    if (writeFailHandler) writeFailHandler(err);\n\n    if (err && process.env.NODE_ENV !== 'production') {\n      console.error('Error storing data', err);\n    }\n  }\n\n  var flush = function flush() {\n    while (keysToProcess.length !== 0) {\n      processNextKey();\n    }\n\n    return writePromise || Promise.resolve();\n  }; // return `persistoid`\n\n\n  return {\n    update: update,\n    flush: flush\n  };\n} // @NOTE in the future this may be exposed via config\n\n\nfunction defaultSerialize(data) {\n  return JSON.stringify(data);\n}"]},"metadata":{},"sourceType":"script"}